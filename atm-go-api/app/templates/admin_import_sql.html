<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATM Go - Tải Lên Tệp SQL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        input[type="file"] {
            display: block;
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background-color: #f9fafb;
            cursor: pointer;
        }
        input[type="file"]::file-selector-button {
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            background-color: #e0e7ff;
            color: #4f46e5;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-right: 15px;
        }
        input[type="file"]::file-selector-button:hover {
            background-color: #c7d2fe;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="container text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Tải Lên Tệp SQL</h1>
        
        <!-- Form để tải lên file SQL -->
        <form id="uploadForm" class="space-y-6">
            <div class="mb-4">
                <label for="sqlFile" class="block text-gray-700 text-lg font-medium mb-2">Chọn tệp SQL:</label>
                <input type="file" id="sqlFile" name="file" accept=".sql" required class="focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <button type="submit" class="btn-primary w-full sm:w-auto">Tải Lên và Thực Thi SQL</button>
        </form>

        <!-- Khu vực hiển thị thông báo -->
        <div id="message" class="mt-6 p-4 rounded-lg hidden" role="alert">
            <p class="font-medium"></p>
        </div>
    </div>

    <script>
        // Lấy các phần tử DOM cần thiết
        const uploadForm = document.getElementById('uploadForm');
        const messageDiv = document.getElementById('message');
        const messageText = messageDiv.querySelector('p');

        // Hàm hiển thị thông báo
        function showMessage(text, type) {
            messageText.textContent = text;
            messageDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800');
            if (type === 'success') {
                messageDiv.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                messageDiv.classList.add('bg-red-100', 'text-red-800');
            }
        }

        // Xử lý sự kiện gửi form
        uploadForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Ngăn chặn hành vi gửi form mặc định

            const fileInput = document.getElementById('sqlFile');
            const file = fileInput.files[0]; // Lấy tệp đã chọn

            if (!file) {
                showMessage('Vui lòng chọn một tệp SQL.', 'error');
                return;
            }

            // Tạo FormData để gửi tệp
            const formData = new FormData();
            formData.append('file', file);

            // Giả lập gửi yêu cầu POST đến endpoint của FastAPI
            // Trong môi trường thực tế, bạn sẽ gửi đến URL "/admin/import_sql"
            // Vì đây là một ví dụ HTML độc lập, chúng ta sẽ mô phỏng phản hồi.
            try {
                // Đây là phần mô phỏng. Trong ứng dụng thực, bạn sẽ có:
                // const response = await fetch('/admin/import_sql', {
                //     method: 'POST',
                //     body: formData
                // });
                // const data = await response.json(); // Hoặc xử lý response khác

                // Mô phỏng thành công sau một khoảng thời gian
                showMessage('Đang tải lên và thực thi...', 'info');
                await new Promise(resolve => setTimeout(resolve, 2000)); // Giả lập độ trễ mạng

                // Giả lập phản hồi thành công
                showMessage(`Tệp "${file.name}" đã được tải lên và thực thi thành công!`, 'success');
                uploadForm.reset(); // Đặt lại form sau khi thành công

                // Trong ứng dụng FastAPI thực, bạn sẽ được chuyển hướng:
                // window.location.href = '/admin/sql';

            } catch (error) {
                console.error('Lỗi khi tải lên tệp:', error);
                showMessage('Đã xảy ra lỗi khi tải lên tệp. Vui lòng thử lại.', 'error');
            }
        });
    </script>
</body>
</html>
